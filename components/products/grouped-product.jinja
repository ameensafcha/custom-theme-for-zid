{#
  Grouped Product Component
  Displays products that are bundled together as a group.
  Uses disclosure pattern matching other product page sections.

  Uses:
    - product.group_products: array of grouped product items
    - Each item has:
      - item: { name, images, short_description, seo }
      - item_quantity: number
#}

{% if product.group_products and product.group_products | length > 0 %}
  <div>
    <button
      type="button"
      command="--toggle"
      commandfor="grouped-products-disclosure"
      class="bg-secondary group flex w-full items-center justify-between gap-3 rounded px-4 py-2"
      aria-expanded="false"
    >
      <div class="flex items-center gap-3">
        <span class="text-foreground text-h6">{{ _("Included products") }}</span>
        <span class="badge badge-outlined border-foreground">
          {{ product.group_products | length }} {{ _("items") }}
        </span>
      </div>
      <span
        class="text-foreground inline-flex size-10 shrink-0 items-center justify-center rounded bg-white/10 p-2.5 backdrop-blur-sm"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          class="transition-transform duration-200 group-aria-expanded:rotate-180"
        >
          <path
            d="M11.999 8.70312C12.0929 8.70312 12.1689 8.73142 12.249 8.81152L17.1924 13.7559C17.2744 13.8378 17.3008 13.9117 17.3008 13.999C17.3008 14.0863 17.2743 14.1602 17.1924 14.2422C17.1143 14.3202 17.0374 14.3506 16.9365 14.3506C16.8359 14.3505 16.7596 14.32 16.6816 14.2422L16.6807 14.2412L12.3516 9.9375L11.998 9.58594L7.31738 14.2666C7.23964 14.3443 7.17341 14.3662 7.09277 14.3633C6.99851 14.3598 6.91711 14.3282 6.83105 14.2422C6.75294 14.1641 6.72266 14.0872 6.72266 13.9863C6.72267 13.8854 6.75294 13.8086 6.83105 13.7305L11.75 8.81152C11.83 8.73152 11.9054 8.7032 11.999 8.70312Z"
            fill="currentColor"
            stroke="currentColor"
          ></path>
        </svg>
      </span>
    </button>
    <el-disclosure
      id="grouped-products-disclosure"
      hidden
      class="transition duration-200 data-closed:opacity-0"
    >
      <div class="mt-4 flex flex-col gap-3 px-4 pb-4">
        {% for groupedProduct in product.group_products %}
          <div class="bg-secondary flex items-center gap-4 rounded-lg p-3">
            {# Product Image #}
            <div class="bg-background size-14 shrink-0 overflow-hidden rounded-lg sm:size-16">
              {% if groupedProduct.item.images and groupedProduct.item.images | length > 0 %}
                <img
                  src="{{ image_url(groupedProduct.item.images[0].image.full_size, w=64, h=64, q=85, f='auto') }}"
                  alt="{{ groupedProduct.item.images[0].alt_text or groupedProduct.item.name }}"
                  class="size-full object-cover"
                  loading="lazy"
                />
              {% else %}
                <div class="flex size-full items-center justify-center">
                  <svg
                    class="text-muted-foreground size-6"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"
                      fill="currentColor"
                    />
                  </svg>
                </div>
              {% endif %}
            </div>

            {# Product Info #}
            <div class="min-w-0 flex-1">
              <h4 class="text-foreground text-subtitle2 line-clamp-2">{{ groupedProduct.item.name }}</h4>
              <div class="text-muted text-caption mt-1 flex items-center gap-2">
                <span>x{{ groupedProduct.item_quantity }}</span>
                {% if groupedProduct.item.short_description %}
                  <span class="text-border">â€¢</span>
                  <span class="line-clamp-1">{{ groupedProduct.item.short_description | striptags }}</span>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </el-disclosure>
  </div>
{% endif %}
