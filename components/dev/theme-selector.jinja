{#
  Theme Selector Component (Development Tool)

  A floating panel that allows quick switching between theme presets.
  Include this in layout.jinja during development to preview themes.

  Usage:
    {% include 'components/dev/theme-selector.jinja' %}
#}

<div
  id="theme-selector"
  class="fixed right-4 bottom-4 z-[9999] font-sans"
  data-theme-selector
>
  {# Toggle Button #}
  <button
    type="button"
    popovertarget="theme-selector-popover"
    class="flex size-12 items-center justify-center rounded-full bg-black text-white shadow-lg transition-transform hover:scale-105"
    aria-label="Toggle theme selector"
  >
    <svg
      class="size-6"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
    >
      <circle
        cx="12"
        cy="12"
        r="5"
      />
      <path
        d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
      />
    </svg>
  </button>

  {# Popover Panel #}
  <el-popover
    id="theme-selector-popover"
    popover
    anchor="top end"
    class="max-h-[70vh] w-80 overflow-hidden rounded-lg border border-neutral-200 bg-white shadow-2xl transition transition-discrete [--anchor-gap:8px] data-closed:translate-y-2 data-closed:opacity-0 data-enter:duration-200 data-enter:ease-out data-leave:duration-150 data-leave:ease-in"
  >
    {# Header #}
    <div class="border-b border-neutral-200 bg-neutral-50 px-4 py-3">
      <h3 class="text-sm font-semibold text-neutral-900">Theme Selector</h3>
      <p class="text-xs text-neutral-500">Development tool - remove in production</p>
    </div>

    {# Search #}
    <div class="border-b border-neutral-200 p-2">
      <input
        type="text"
        class="w-full rounded border border-neutral-300 px-3 py-1.5 text-sm outline-none focus:border-blue-500"
        placeholder="Search themes..."
        data-theme-search
      />
    </div>

    {# Theme List #}
    <div
      class="max-h-[50vh] overflow-y-auto p-2"
      data-theme-list
    >
      {# Themes will be populated by JS #}
    </div>

    {# Current Theme Info #}
    <div class="border-t border-neutral-200 bg-neutral-50 px-4 py-3">
      <div class="text-xs text-neutral-500">Current theme:</div>
      <div
        class="text-sm font-medium text-neutral-900"
        data-current-theme
      >
        Default
      </div>
    </div>

    {# Actions #}
    <div class="flex gap-2 border-t border-neutral-200 p-2">
      <button
        type="button"
        class="flex-1 rounded bg-neutral-900 px-3 py-1.5 text-xs font-medium text-white hover:bg-neutral-700"
        data-copy-theme
      >
        Copy CSS Variables
      </button>
      <button
        type="button"
        class="flex-1 rounded bg-blue-600 px-3 py-1.5 text-xs font-medium text-white hover:bg-blue-500"
        data-copy-schema
      >
        Copy Schema JSON
      </button>
    </div>
  </el-popover>
</div>

<script>
  (function () {
    // Theme presets data
    const THEME_PRESETS = {
      default: {
        name: "Default",
        name_ar: "الافتراضي",
        category: "Neutral",
        colors: {
          primary: "#0B0A09",
          primary_foreground: "#FFFFFF",
          secondary: "#F6F5F4",
          accent: "#A89C90",
          background: "#FFFFFF",
          foreground: "#0B0A09",
          muted: "#545352",
          border: "#B5B5B5",
          input: "#545352",
          ring: "#0B0A09"
        },
        radius: 4
      },
      "modern-minimal": {
        name: "Modern Minimal",
        name_ar: "بساطة عصرية",
        category: "Pure Blue",
        colors: {
          primary: "#3B82F6",
          primary_foreground: "#FFFFFF",
          secondary: "#F3F4F6",
          accent: "#DBEAFE",
          background: "#FFFFFF",
          foreground: "#333333",
          muted: "#6B7280",
          border: "#E5E7EB",
          input: "#E5E7EB",
          ring: "#3B82F6"
        },
        radius: 0
      },
      "ocean-blue": {
        name: "Oceanic",
        name_ar: "محيطي",
        category: "Pure Blue",
        colors: {
          primary: "#1E9DF1",
          primary_foreground: "#FFFFFF",
          secondary: "#0F1419",
          accent: "#E3ECF6",
          background: "#FFFFFF",
          foreground: "#0F1419",
          muted: "#536471",
          border: "#EFF3F4",
          input: "#EFF3F4",
          ring: "#1E9DF1"
        },
        radius: 20
      },
      "clean-slate": {
        name: "Clean Slate",
        name_ar: "صفاء",
        category: "Pure Blue",
        colors: {
          primary: "#6366F1",
          primary_foreground: "#FFFFFF",
          secondary: "#E5E7EB",
          accent: "#E0E7FF",
          background: "#F8FAFC",
          foreground: "#1E293B",
          muted: "#64748B",
          border: "#CBD5E1",
          input: "#CBD5E1",
          ring: "#6366F1"
        },
        radius: 8
      },
      mint: {
        name: "Cool Mint",
        name_ar: "نعناع بارد",
        category: "Green Serenity",
        colors: {
          primary: "#72E3AD",
          primary_foreground: "#1A4D3E",
          secondary: "#FDFDFD",
          accent: "#EDEDED",
          background: "#FDFDFD",
          foreground: "#171717",
          muted: "#525252",
          border: "#D4D4D4",
          input: "#E5E5E5",
          ring: "#72E3AD"
        },
        radius: 8
      },
      nature: {
        name: "Nature",
        name_ar: "طبيعة",
        category: "Green Serenity",
        colors: {
          primary: "#2E7D32",
          primary_foreground: "#FFFFFF",
          secondary: "#E8F5E9",
          accent: "#C8E6C9",
          background: "#FAFAF5",
          foreground: "#3E2723",
          muted: "#5D4037",
          border: "#C8B89A",
          input: "#C8B89A",
          ring: "#2E7D32"
        },
        radius: 8
      },
      "coastal-breeze": {
        name: "Coastal Breeze",
        name_ar: "نسيم الساحل",
        category: "Green Serenity",
        colors: {
          primary: "#0D9488",
          primary_foreground: "#FFFFFF",
          secondary: "#B8C9CC",
          accent: "#CCFBF1",
          background: "#F0F9F7",
          foreground: "#134E4A",
          muted: "#5F9EA0",
          border: "#A7C7C9",
          input: "#A7C7C9",
          ring: "#0D9488"
        },
        radius: 10
      },
      "sunset-warm": {
        name: "Sunset Warm",
        name_ar: "غروب دافئ",
        category: "Warm Tones",
        colors: {
          primary: "#EA580C",
          primary_foreground: "#FFFFFF",
          secondary: "#FFF7ED",
          accent: "#FFEDD5",
          background: "#FFFBF5",
          foreground: "#431407",
          muted: "#9A3412",
          border: "#FED7AA",
          input: "#FED7AA",
          ring: "#EA580C"
        },
        radius: 8
      },
      "rose-gold": {
        name: "Rose Gold",
        name_ar: "ذهبي وردي",
        category: "Warm Tones",
        colors: {
          primary: "#DB2777",
          primary_foreground: "#FFFFFF",
          secondary: "#FDF2F8",
          accent: "#FBCFE8",
          background: "#FFFBFC",
          foreground: "#831843",
          muted: "#9D174D",
          border: "#F9A8D4",
          input: "#F9A8D4",
          ring: "#DB2777"
        },
        radius: 12
      },
      "lavender-dream": {
        name: "Lavender Dream",
        name_ar: "حلم اللافندر",
        category: "Soft Purple",
        colors: {
          primary: "#8B5CF6",
          primary_foreground: "#FFFFFF",
          secondary: "#F5F3FF",
          accent: "#EDE9FE",
          background: "#FDFCFF",
          foreground: "#3B0764",
          muted: "#6B21A8",
          border: "#DDD6FE",
          input: "#DDD6FE",
          ring: "#8B5CF6"
        },
        radius: 12
      },
      "dark-mode": {
        name: "Dark Mode",
        name_ar: "الوضع الداكن",
        category: "Dark",
        colors: {
          primary: "#FFFFFF",
          primary_foreground: "#0A0A0A",
          secondary: "#262626",
          accent: "#404040",
          background: "#0A0A0A",
          foreground: "#FAFAFA",
          muted: "#A1A1AA",
          border: "#3F3F46",
          input: "#3F3F46",
          ring: "#FFFFFF"
        },
        radius: 6
      },
      "midnight-blue": {
        name: "Midnight Blue",
        name_ar: "أزرق منتصف الليل",
        category: "Dark",
        colors: {
          primary: "#3B82F6",
          primary_foreground: "#FFFFFF",
          secondary: "#1E3A5F",
          accent: "#1E40AF",
          background: "#0F172A",
          foreground: "#E2E8F0",
          muted: "#94A3B8",
          border: "#334155",
          input: "#334155",
          ring: "#3B82F6"
        },
        radius: 8
      },
      "coffee-mocha": {
        name: "Coffee Mocha",
        name_ar: "قهوة موكا",
        category: "Warm Tones",
        colors: {
          primary: "#78350F",
          primary_foreground: "#FFFFFF",
          secondary: "#FEF3C7",
          accent: "#FDE68A",
          background: "#FFFBEB",
          foreground: "#451A03",
          muted: "#92400E",
          border: "#D97706",
          input: "#D97706",
          ring: "#78350F"
        },
        radius: 6
      },
      "forest-green": {
        name: "Forest Green",
        name_ar: "أخضر الغابة",
        category: "Green Serenity",
        colors: {
          primary: "#166534",
          primary_foreground: "#FFFFFF",
          secondary: "#DCFCE7",
          accent: "#BBF7D0",
          background: "#F0FDF4",
          foreground: "#14532D",
          muted: "#15803D",
          border: "#86EFAC",
          input: "#86EFAC",
          ring: "#166534"
        },
        radius: 4
      },
      "cherry-blossom": {
        name: "Cherry Blossom",
        name_ar: "زهر الكرز",
        category: "Soft Purple",
        colors: {
          primary: "#EC4899",
          primary_foreground: "#FFFFFF",
          secondary: "#FDF4FF",
          accent: "#F5D0FE",
          background: "#FEFBFF",
          foreground: "#701A75",
          muted: "#A21CAF",
          border: "#F0ABFC",
          input: "#F0ABFC",
          ring: "#EC4899"
        },
        radius: 16
      },
      "slate-professional": {
        name: "Slate Professional",
        name_ar: "رمادي احترافي",
        category: "Neutral",
        colors: {
          primary: "#475569",
          primary_foreground: "#FFFFFF",
          secondary: "#F1F5F9",
          accent: "#E2E8F0",
          background: "#FFFFFF",
          foreground: "#1E293B",
          muted: "#64748B",
          border: "#CBD5E1",
          input: "#94A3B8",
          ring: "#475569"
        },
        radius: 4
      }
    };

    let currentTheme = "default";
    const container = document.querySelector("[data-theme-selector]");
    const themeList = container.querySelector("[data-theme-list]");
    const searchInput = container.querySelector("[data-theme-search]");
    const currentThemeDisplay = container.querySelector("[data-current-theme]");
    const copyThemeBtn = container.querySelector("[data-copy-theme]");
    const copySchemaBtn = container.querySelector("[data-copy-schema]");

    // Render theme list
    function renderThemes(filter = "") {
      const categories = {};

      Object.entries(THEME_PRESETS).forEach(([key, theme]) => {
        if (
          filter &&
          !theme.name.toLowerCase().includes(filter.toLowerCase()) &&
          !theme.name_ar.includes(filter) &&
          !theme.category.toLowerCase().includes(filter.toLowerCase())
        ) {
          return;
        }

        if (!categories[theme.category]) {
          categories[theme.category] = [];
        }
        categories[theme.category].push({ key, ...theme });
      });

      themeList.innerHTML = Object.entries(categories)
        .map(
          ([category, themes]) => `
      <div class="mb-3">
        <div class="px-2 py-1 text-xs font-semibold text-neutral-500 uppercase tracking-wider">${category}</div>
        <div class="space-y-1">
          ${themes
            .map(
              (theme) => `
            <button
              type="button"
              class="flex w-full items-center gap-3 rounded px-2 py-2 text-left transition-colors hover:bg-neutral-100 ${currentTheme === theme.key ? "bg-neutral-100 ring-1 ring-blue-500" : ""}"
              data-theme-key="${theme.key}"
            >
              <div class="flex gap-0.5 shrink-0">
                <div class="size-4 rounded-l" style="background: ${theme.colors.primary}"></div>
                <div class="size-4" style="background: ${theme.colors.secondary}"></div>
                <div class="size-4 rounded-r" style="background: ${theme.colors.accent}"></div>
              </div>
              <div class="flex-1 min-w-0">
                <div class="text-sm font-medium text-neutral-900 truncate">${theme.name}</div>
                <div class="text-xs text-neutral-500">${theme.name_ar}</div>
              </div>
              <div class="text-xs text-neutral-400">${theme.radius}px</div>
            </button>
          `
            )
            .join("")}
        </div>
      </div>
    `
        )
        .join("");

      // Add click handlers
      themeList.querySelectorAll("[data-theme-key]").forEach((btn) => {
        btn.addEventListener("click", () => {
          applyTheme(btn.dataset.themeKey);
        });
      });
    }

    // Apply theme
    function applyTheme(themeKey) {
      const theme = THEME_PRESETS[themeKey];
      if (!theme) return;

      currentTheme = themeKey;
      const root = document.documentElement;

      // Apply colors
      Object.entries(theme.colors).forEach(([key, value]) => {
        const varName = key.replace(/_/g, "-");
        root.style.setProperty(`--${varName}`, value);
      });

      // Apply radius
      root.style.setProperty("--radius", `${theme.radius}px`);
      root.style.setProperty("--radius-sm", `${Math.max(0, theme.radius * 0.5)}px`);
      root.style.setProperty("--radius-lg", `${theme.radius * 2}px`);
      root.style.setProperty("--radius-xl", `${theme.radius * 3}px`);

      // Update UI
      currentThemeDisplay.textContent = theme.name;
      renderThemes(searchInput.value);

      // Save to localStorage
      localStorage.setItem("vitrin-dev-theme", themeKey);
    }

    // Search
    searchInput.addEventListener("input", (e) => {
      renderThemes(e.target.value);
    });

    // Copy CSS variables
    copyThemeBtn.addEventListener("click", () => {
      const theme = THEME_PRESETS[currentTheme];
      const css =
        Object.entries(theme.colors)
          .map(([key, value]) => `--${key.replace(/_/g, "-")}: ${value};`)
          .join("\n") + `\n--radius: ${theme.radius}px;`;

      navigator.clipboard.writeText(css).then(() => {
        copyThemeBtn.textContent = "Copied!";
        setTimeout(() => {
          copyThemeBtn.textContent = "Copy CSS Variables";
        }, 2000);
      });
    });

    // Copy schema JSON
    copySchemaBtn.addEventListener("click", () => {
      const theme = THEME_PRESETS[currentTheme];
      const schema = {
        theme: {
          primary: theme.colors.primary,
          primary_foreground: theme.colors.primary_foreground,
          secondary: theme.colors.secondary,
          accent: theme.colors.accent,
          background: theme.colors.background,
          foreground: theme.colors.foreground,
          muted: theme.colors.muted,
          border: theme.colors.border,
          input: theme.colors.input,
          ring: theme.colors.ring,
          radius: theme.radius
        }
      };

      navigator.clipboard.writeText(JSON.stringify(schema, null, 2)).then(() => {
        copySchemaBtn.textContent = "Copied!";
        setTimeout(() => {
          copySchemaBtn.textContent = "Copy Schema JSON";
        }, 2000);
      });
    });

    // Initialize
    const savedTheme = localStorage.getItem("vitrin-dev-theme");
    if (savedTheme && THEME_PRESETS[savedTheme]) {
      applyTheme(savedTheme);
    }
    renderThemes();
  })();
</script>
