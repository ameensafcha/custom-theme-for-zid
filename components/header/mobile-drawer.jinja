{# Mobile Navigation Drawer - Full Page Overlay #}
<el-dialog id="mobile-drawer-dialog" class="group contents">
  <button command="show-modal" commandfor="mobile-drawer"
    class="text-foreground relative h-10 w-10 p-2 group-data-[transition]:pointer-events-none focus:outline-none lg:hidden"
    aria-label="Toggle menu">
    <span aria-hidden="true"
      class="absolute block h-0.5 w-5 transform bg-current transition duration-500 ease-in-out group-data-[closed]:-translate-y-1.5 group-data-[enter]:rotate-45 group-data-[leave]:!rotate-0 group-[:not([open])]:-translate-y-1.5 group-[[open]]:rotate-45"></span>
    <span aria-hidden="true"
      class="absolute block h-0.5 w-5 transform bg-current transition duration-500 ease-in-out group-data-[enter]:opacity-0 group-data-[leave]:!opacity-100 group-[[open]]:opacity-0"></span>
    <span aria-hidden="true"
      class="absolute block h-0.5 w-5 transform bg-current transition duration-500 ease-in-out group-data-[closed]:translate-y-1.5 group-data-[enter]:-rotate-45 group-data-[leave]:!-rotate-0 group-[:not([open])]:translate-y-1.5 group-[[open]]:-rotate-45"></span>
  </button>
  <dialog id="mobile-drawer" aria-labelledby="drawer-title"
    class="fixed inset-0 size-auto max-h-none max-w-none overflow-hidden bg-transparent not-open:hidden backdrop:bg-transparent">
    <el-dialog-backdrop
      class="absolute inset-0 bg-black/10 backdrop-blur-sm transition-opacity duration-500 ease-in-out data-closed:opacity-0"></el-dialog-backdrop>
    <div tabindex="0" class="absolute inset-0 focus:outline-none">
      <el-dialog-panel
        class="group/dialog-panel relative block size-full transform transition duration-500 ease-in-out data-closed:translate-x-full sm:duration-700">
        <div class="bg-background relative flex h-full flex-col">
          {# Top bar: Close button (left) + Menu title (right) #}
          <div class="flex items-center justify-between px-4 py-3 border-b border-border-light">
            <button type="button" command="close" commandfor="mobile-drawer"
              class="text-foreground size-10 flex items-center justify-center" aria-label="{{ _('Close') }}">
              <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
            <span id="drawer-title" class="text-foreground text-base font-semibold">{{ _('Menu') }}</span>
          </div>

          {# Search bar - full width, no popup #}
          <div class="px-4 py-3 border-b border-border-light">
            <form action="/products" method="get"
              class="flex items-center bg-secondary border border-border rounded-full px-4 py-2.5 gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                class="text-muted-foreground shrink-0" fill="none">
                <path
                  d="M9.37695 3.37329C11.0475 3.37338 12.4514 3.95645 13.6182 5.1311C14.7863 6.30701 15.3652 7.71368 15.3652 9.37915C15.3652 10.0477 15.2604 10.6838 15.0518 11.2903C14.8436 11.8953 14.5304 12.4664 14.1084 13.0042L13.833 13.3547L14.1494 13.6682L20.1631 19.6321L20.166 19.634C20.2363 19.7029 20.2705 19.7798 20.2705 19.8967C20.2704 19.9847 20.2509 20.0516 20.21 20.1106L20.1621 20.1672L20.1602 20.1692C20.0833 20.2468 20.0021 20.2815 19.8867 20.2815C19.772 20.2815 19.7016 20.2473 19.6377 20.179L19.6318 20.1731L19.625 20.1672L13.6367 14.1838L13.3105 13.8586L12.96 14.1565C12.5697 14.4877 12.1179 14.7581 11.6016 14.9661L11.376 15.052C10.7695 15.2676 10.1165 15.3772 9.41406 15.3772C7.71323 15.3772 6.29193 14.7923 5.11914 13.6184C3.9443 12.4422 3.36235 11.0371 3.3623 9.37524C3.3623 7.71348 3.94477 6.3084 5.12109 5.13208C6.29674 3.95628 7.70599 3.37329 9.37695 3.37329ZM9.39062 4.07642C8.01061 4.07651 6.81093 4.53417 5.81543 5.44165L5.61816 5.62915C4.58695 6.66009 4.06543 7.91834 4.06543 9.37524C4.06548 10.8321 4.5874 12.0894 5.61816 13.1204C6.65036 14.1527 7.91745 14.673 9.39062 14.6731C10.8518 14.6731 12.1081 14.1517 13.1289 13.1184C14.1478 12.087 14.6621 10.8301 14.6621 9.37524C14.6621 7.92014 14.1476 6.66252 13.1279 5.6311C12.1067 4.59801 10.8508 4.07642 9.39062 4.07642Z"
                  fill="currentColor" stroke="currentColor"></path>
              </svg>
              <input type="search" name="q" placeholder="{{ _('Search') }}..."
                class="flex-1 bg-transparent text-sm outline-none border-none text-foreground placeholder:text-muted-foreground"
                autocomplete="off" />
            </form>
          </div>

          {# Navigation menu - scrollable #}
          <div class="flex h-full flex-col items-start overflow-y-auto">
            <div class="flex w-full flex-col py-2">
              {% for menu in store.settings.menus.main_menu.items %}
              {% if menu.items | length > 0 %}
              <details class="group w-full">
                <summary
                  class="text-foreground text-sm flex w-full cursor-pointer items-center justify-between gap-1 px-6 py-3 select-none">
                  <span class="text-foreground text-sm min-h-px min-w-px flex-1 text-start">
                    {{ menu.label }}
                  </span>
                  <svg
                    class="text-foreground size-4 transition-transform group-open:rotate-90 rtl:rotate-180 rtl:group-open:-rotate-90"
                    viewBox="0 0 16 16" fill="none">
                    <path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                      stroke-linejoin="round" />
                  </svg>
                </summary>
                <div class="mt-1 space-y-1 ps-4">
                  {% for submenu in menu.items %}
                  {% if submenu.items | length > 0 %}
                  <details class="group/sub w-full">
                    <summary
                      class="text-foreground text-sm flex w-full cursor-pointer items-center justify-between gap-1 px-6 py-3 select-none">
                      <span class="min-h-px min-w-px flex-1 text-start"> {{ submenu.label }} </span>
                      <svg
                        class="text-foreground size-4 transition-transform group-open/sub:rotate-90 rtl:rotate-180 rtl:group-open/sub:-rotate-90"
                        viewBox="0 0 16 16" fill="none">
                        <path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                          stroke-linejoin="round" />
                      </svg>
                    </summary>
                    <div class="mt-1 space-y-1 ps-4">
                      <a href="{{ submenu.url | localized_url if submenu.resource_type != 'url' else submenu.url }}"
                        class="text-muted text-sm block px-6 py-3">
                        {{ _("All") }} {{ submenu.label }}
                      </a>
                      {% for subsubmenu in submenu.items %}
                      <a href="{{ subsubmenu.url | localized_url if subsubmenu.resource_type != 'url' else subsubmenu.url }}"
                        class="text-muted text-sm block px-6 py-3">
                        {{ subsubmenu.label }}
                      </a>
                      {% endfor %}
                    </div>
                  </details>
                  {% else %}
                  <a href="{{ submenu.url | localized_url if submenu.resource_type != 'url' else submenu.url }}"
                    class="text-foreground text-sm block px-6 py-3">
                    {{ submenu.label }}
                  </a>
                  {% endif %}
                  {% endfor %}
                </div>
              </details>
              {% else %}
              <a href="{{ menu.url | localized_url if menu.resource_type != 'url' else menu.url }}"
                class="text-foreground text-sm min-h-px w-full min-w-px px-6 py-3 text-start">
                {{ menu.label }}
              </a>
              {% endif %}
              {% endfor %}
            </div>

            {# Footer: Login/Account + Region #}
            <div class="border-border-light flex w-full flex-col items-start gap-[3px] border-t pt-4 pb-6 mt-auto">
              {# Logged out state #}
              <button id="mobile-login-btn" type="button" onclick="handleLoginAction()"
                class="text-foreground text-sm min-h-px w-full min-w-px px-6 py-3 text-start">
                {{ _("Login") }}
              </button>
              {# Logged in state #}
              <div id="mobile-logged-in-links" class="hidden w-full flex-col">
                <a href="{{ url_for('profile') }}"
                  class="text-foreground text-sm min-h-px w-full min-w-px px-6 py-3 text-start">
                  {{ _("Account") }}
                </a>
                <button type="button" onclick="zid.customer.logout()"
                  class="text-foreground text-sm min-h-px w-full min-w-px px-6 py-3 text-start">
                  {{ _("Log out") }}
                </button>
              </div>
              {# Mobile Region Selector #}
              {% set multiple_countries = store.countries | length > 1 %}
              {% set multiple_languages = store.languages | length > 1 %}
              {% set show_country = multiple_countries and not safeget(settings, "header_hide_country", false) %}
              {% set show_language = multiple_languages and not safeget(settings, "header_hide_language", false) %}
              {% if show_country or show_language %}
              <button type="button"
                onclick="document.getElementById('mobile-drawer-dialog')?.hide(); zidOpenRegionSettingDialog();"
                class="text-foreground text-sm flex w-full items-center gap-2 px-6 py-3 text-start">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="1.5">
                  <circle cx="12" cy="12" r="10" />
                  <path
                    d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
                </svg>
                <span class="nav-country-text">
                  {% if show_country %}{{ session.country.name }}{% if show_language %}|{% endif %}{% endif %}
                </span>
                {% if show_language %}{{ session.lang | upper }}{% endif %}
              </button>
              {% endif %}
            </div>
          </div>
        </div>
      </el-dialog-panel>
    </div>
  </dialog>
</el-dialog>