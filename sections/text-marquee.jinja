{% if settings.marquee_text and settings.marquee_text | trim %}
<section section-id="{{ sectionId }}" class="overflow-hidden py-3 md:py-5"
    style="background-color: {{ settings.bg_color | default('#000000') }}; color: {{ settings.text_color | default('#FFFFFF') }};">

    {# Seamless marquee using CSS animation + JS cloning for perfect loop #}
    <div class="marquee-track" data-marquee-track style="font-size: clamp(16px, 4vw, 22px);">
        <div class="marquee-content" data-marquee-content>
            {% for i in range(10) %}
            <span class="marquee-item">{{ settings.marquee_text }}</span>
            {% endfor %}
        </div>
    </div>

    <style>
        .marquee-track {
            overflow: hidden;
            width: 100%;
            position: relative;
        }

        .marquee-content {
            display: flex;
            width: max-content;
            animation: marquee-scroll 60s linear infinite;
        }

        .marquee-item {
            white-space: nowrap;
            flex-shrink: 0;
            padding: 0 2rem;
        }

        @keyframes marquee-scroll {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-50%);
            }
        }

        [dir="rtl"] .marquee-content {
            animation-name: marquee-scroll-rtl;
        }

        @keyframes marquee-scroll-rtl {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(50%);
            }
        }

        section:hover .marquee-content {
            animation-play-state: paused;
        }
    </style>

    <script>
        (function () {
            var track = document.querySelector('[data-marquee-track]');
            if (!track) return;
            var content = track.querySelector('[data-marquee-content]');
            if (!content) return;

            // Clone the content to ensure seamless loop
            var clone = content.cloneNode(true);
            // Append all children of clone into original content
            var items = clone.querySelectorAll('.marquee-item');
            for (var i = 0; i < items.length; i++) {
                content.appendChild(items[i].cloneNode(true));
            }
        })();
    </script>
</section>
{% endif %}