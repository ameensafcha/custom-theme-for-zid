{% set is_lazy = settings.order > 2 %}

<section
  section-id="{{ sectionId }}"
  class="bg-background px-4 py-6 md:p-16"
>
  <div class="theme-container">
    {% if settings.title %}
      <h2 class="text-foreground text-h4 md:text-h3 mb-6">{{ settings.title }}</h2>
    {% endif %}
    {% if settings.gallery %}
      {% set item_count = settings.gallery | length %}
      <div
        class="grid grid-cols-2 gap-4 md:grid-cols-4 [&_.media-wrap]:aspect-[4/3] [&[data-items-count='1']]:grid-cols-1 [&[data-items-count='1']]:md:grid-cols-2 [&[data-items-count='2']]:grid-cols-1 [&[data-items-count='2']]:md:grid-cols-2 [&[data-items-count='3']]:auto-rows-[153px] [&[data-items-count='3']]:grid-cols-2 [&[data-items-count='3']]:md:auto-rows-[314px] [&[data-items-count='3']_.media-wrap]:aspect-auto [&[data-items-count='3']_.media-wrap]:h-full [&[data-items-count='3']_.media-wrap]:w-full [&[data-items-count='3']>*:first-child]:col-span-2 [&[data-items-count='3']>*:first-child]:row-span-2 [&[data-items-count='4']]:grid-cols-1 [&[data-items-count='4']]:md:grid-cols-2 [&[data-items-count='5']]:auto-rows-[153px] [&[data-items-count='5']]:grid-cols-2 [&[data-items-count='5']]:md:auto-rows-[314px] [&[data-items-count='5']]:md:grid-cols-4 [&[data-items-count='5']_.media-wrap]:aspect-auto [&[data-items-count='5']_.media-wrap]:h-full [&[data-items-count='5']_.media-wrap]:w-full [&[data-items-count='5']>*:first-child]:col-span-2 [&[data-items-count='5']>*:first-child]:row-span-2"
        data-items-count="{{ item_count }}"
      >
        {% for item in settings.gallery %}
          <div class="group relative overflow-hidden rounded">
            <div class="media-wrap">
              <picture>
                {% if item.src_mobile %}
                  <source
                    media="(max-width: 767px)"
                    srcset="{{ image_url(item.src_mobile, w=400, q=80, f='auto') }}"
                  />
                {% endif %}
                <img
                  src="{{ image_url(item.src, w=800, q=85, f='auto') }}"
                  alt="{{ item.alt }}"
                  class="h-full w-full object-cover"
                  {% if is_lazy or not loop.first %}loading="lazy"{% endif %}
                />
              </picture>
            </div>

            {% if item.image_title or item.primary_button_text or item.secondary_button_text %}
              <div class="absolute inset-0 flex flex-col items-center justify-center space-y-6">
                {% if item.image_title %}
                  <h3 class="text-foreground text-h5 md:text-h4 text-center">{{ item.image_title }}</h3>
                {% endif %}

                {% if item.primary_button_text or item.secondary_button_text %}
                  <div class="flex flex-wrap items-center justify-center gap-4">
                    {% if item.primary_button_text and item.primary_button_url %}
                      <a
                        href="{{ item.primary_button_url }}"
                        class="btn btn-filled btn-lg"
                      >
                        {{ item.primary_button_text }}
                      </a>
                    {% endif %}
                    {% if item.secondary_button_text and item.secondary_button_url %}
                      <a
                        href="{{ item.secondary_button_url }}"
                        class="btn btn-outlined btn-lg"
                      >
                        {{ item.secondary_button_text }}
                      </a>
                    {% endif %}
                  </div>
                {% endif %}
              </div>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>
</section>
